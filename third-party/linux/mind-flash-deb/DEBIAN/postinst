#!/bin/bash
ln -sf /opt/mind-flash/mf_gui.py /usr/bin/msh-gui
ln -sf /opt/mind-flash/mf_entity.py /usr/bin/msh

OSNAME=`lsb_release -is`
GNOME_ENTRY=org.gnome.settings-daemon.plugins.media-keys
GNOME_PATH=/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/

if [[ "$OSNAME" == "Ubuntu" ]]; then
    echo "gsettings custom keybindings 'Win+N' for Ubuntu."
    gsettings set $GNOME_ENTRY custom-keybindings "['$GNOME_PATH']"
    gsettings set $GNOME_ENTRY.custom-keybindings:$GNOME_PATH name "mind-flash"
    gsettings set $GNOME_ENTRY.custom-keybindings:$GNOME_PATH command "/usr/bin/msh-gui"
    gsettings set $GNOME_ENTRY.custom-keybindings:$GNOME_PATH binding "<Super>n"
elif [[ "$OSNAME" == "Deepin" ]]; then
    # Reference: https://bbs.deepin.org/archiver/?tid-148930.html
    echo "gsettings custom keybindings 'Win+N' for Deepin."
    dbus-send --session --dest=com.deepin.daemon.Keybinding --type=method_call --print-reply /com/deepin/daemon/Keybinding com.deepin.daemon.Keybinding.AddCustomShortcut string:"Mind Flash" string:"/usr/bin/msh-gui" string:"<Super>N" 1>/dev/null
fi